resource "azurerm_policy_set_definition" "res-0" {
  description         = "Choose either Deploy if not exist and append in combination with audit or Select Deny in the Policy effect. Deny polices shift left. Deploy if not exist and append enforce but can be changed, and because missing exsistense condition require then the combination of Audit. "
  display_name        = "Deny or Deploy and append TLS requirements and SSL enforcement on resources without Encryption in transit"
  management_group_id = "/providers/Microsoft.Management/managementGroups/101"
  name                = "Enforce-EncryptTransit"
  parameters          = "{\"AKSIngressHttpsOnlyEffect\":{\"type\":\"String\",\"allowedValues\":[\"audit\",\"deny\",\"disabled\"],\"defaultValue\":\"deny\",\"metadata\":{\"description\":\"This policy enforces HTTPS ingress in a Kubernetes cluster. This policy is generally available for Kubernetes Service (AKS), and preview for AKS Engine and Azure Arc enabled Kubernetes. For instructions on using this policy, visit https://aka.ms/kubepolicydoc.\",\"displayName\":\"AKS Service. Enforce HTTPS ingress in Kubernetes cluster\"}},\"APIAppServiceHttpsEffect\":{\"type\":\"String\",\"allowedValues\":[\"Audit\",\"Disabled\",\"Deny\"],\"defaultValue\":\"Audit\",\"metadata\":{\"description\":\"Choose Deny or Audit in combination with Append policy. Use of HTTPS ensures server/service authentication and protects data in transit from network layer eavesdropping attacks.\",\"displayName\":\"App Service API App. API App should only be accessible over HTTPS. Choose Deny or Audit in combination with Append policy.\"}},\"APIAppServiceLatestTlsEffect\":{\"type\":\"String\",\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"],\"defaultValue\":\"AuditIfNotExists\",\"metadata\":{\"description\":\"App Service API App. Only Audit, deny not possible as it is a related resource.  Upgrade to the latest TLS version.\",\"displayName\":\"App Service API App. Latest TLS version should be used in your API App\"}},\"AppServiceHttpEffect\":{\"type\":\"String\",\"allowedValues\":[\"Append\",\"Disabled\"],\"defaultValue\":\"Append\",\"metadata\":{\"description\":\"Append the AppService sites object to ensure that min Tls version is set to required TLS version. Please note Append does not enforce compliance use then deny.\",\"displayName\":\"App Service. Appends the AppService sites config WebApp, APIApp, Function App with TLS version selected below\"}},\"AppServiceTlsVersionEffect\":{\"type\":\"String\",\"allowedValues\":[\"Append\",\"Disabled\"],\"defaultValue\":\"Append\",\"metadata\":{\"description\":\"App Service. Appends the AppService sites object to ensure that  HTTPS only is enabled for  server/service authentication and protects data in transit from network layer eavesdropping attacks. Please note Append does not enforce compliance use then deny.\",\"displayName\":\"App Service. Appends the AppService WebApp, APIApp, Function App to enable https only\"}},\"AppServiceminTlsVersion\":{\"type\":\"String\",\"allowedValues\":[\"1.2\",\"1.0\",\"1.1\"],\"defaultValue\":\"1.2\",\"metadata\":{\"description\":\"App Service. Select version  minimum TLS version for a  Web App config to enforce\",\"displayName\":\"App Service. Select version minimum TLS Web App config\"}},\"FunctionLatestTlsEffect\":{\"type\":\"String\",\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"],\"defaultValue\":\"AuditIfNotExists\",\"metadata\":{\"description\":\"Only Audit, deny not possible as it is a related resource. Upgrade to the latest TLS version.\",\"displayName\":\"App Service Function App. Latest TLS version should be used in your Function App\"}},\"FunctionServiceHttpsEffect\":{\"type\":\"String\",\"allowedValues\":[\"Audit\",\"Disabled\",\"Deny\"],\"defaultValue\":\"Audit\",\"metadata\":{\"description\":\"App Service Function App. Choose Deny or Audit in combination with Append policy. Use of HTTPS ensures server/service authentication and protects data in transit from network layer eavesdropping attacks.\",\"displayName\":\"App Service Function App. Function App should only be accessible over HTTPS. Choose Deny or Audit in combination with Append policy.\"}},\"MySQLEnableSSLDeployEffect\":{\"type\":\"String\",\"allowedValues\":[\"DeployIfNotExists\",\"Disabled\"],\"defaultValue\":\"DeployIfNotExists\",\"metadata\":{\"description\":\"Deploy a specific min TLS version requirement and enforce SSL on Azure Database for MySQL server. Enforce the Server to client applications using minimum version of Tls to secure the connection between your database server and your client applications helps protect against 'man in the middle' attacks by encrypting the data stream between the server and your application. This configuration enforces that SSL is always enabled for accessing your database server.\",\"displayName\":\"MySQL database servers. Deploy if not exist set minimum TLS version Azure Database for MySQL server\"}},\"MySQLEnableSSLEffect\":{\"type\":\"String\",\"allowedValues\":[\"Audit\",\"Disabled\",\"Deny\"],\"defaultValue\":\"Audit\",\"metadata\":{\"description\":\"Azure Database for MySQL supports connecting your Azure Database for MySQL server to client applications using Secure Sockets Layer (SSL). Enforcing SSL connections between your database server and your client applications helps protect against 'man in the middle' attacks by encrypting the data stream between the server and your application. This configuration enforces that SSL is always enabled for accessing your database server.\",\"displayName\":\"MySQL database servers. Enforce SSL connection should be enabled for MySQL database servers\"}},\"MySQLminimalTlsVersion\":{\"type\":\"String\",\"allowedValues\":[\"TLS1_2\",\"TLS1_0\",\"TLS1_1\",\"TLSEnforcementDisabled\"],\"defaultValue\":\"TLS1_2\",\"metadata\":{\"description\":\"Select version  minimum TLS version Azure Database for MySQL server to enforce\",\"displayName\":\"MySQL database servers. Select version minimum TLS for MySQL server\"}},\"PostgreSQLEnableSSLDeployEffect\":{\"type\":\"String\",\"allowedValues\":[\"DeployIfNotExists\",\"Disabled\"],\"defaultValue\":\"DeployIfNotExists\",\"metadata\":{\"description\":\"Deploy a specific min TLS version requirement and enforce SSL on Azure Database for PostgreSQL server. Enforce the Server to client applications using minimum version of Tls to secure the connection between your database server and your client applications helps protect against 'man in the middle' attacks by encrypting the data stream between the server and your application. This configuration enforces that SSL is always enabled for accessing your database server.\",\"displayName\":\"PostgreSQL database servers. Deploy if not exist set minimum TLS version Azure Database for PostgreSQL server\"}},\"PostgreSQLEnableSSLEffect\":{\"type\":\"String\",\"allowedValues\":[\"Audit\",\"Disabled\",\"Deny\"],\"defaultValue\":\"Audit\",\"metadata\":{\"description\":\"Azure Database for PostgreSQL supports connecting your Azure Database for PostgreSQL server to client applications using Secure Sockets Layer (SSL). Enforcing SSL connections between your database server and your client applications helps protect against 'man in the middle' attacks by encrypting the data stream between the server and your application. This configuration enforces that SSL is always enabled for accessing your database server.\",\"displayName\":\"PostgreSQL database servers. Enforce SSL connection should be enabled for PostgreSQL database servers\"}},\"PostgreSQLminimalTlsVersion\":{\"type\":\"String\",\"allowedValues\":[\"TLS1_2\",\"TLS1_0\",\"TLS1_1\",\"TLSEnforcementDisabled\"],\"defaultValue\":\"TLS1_2\",\"metadata\":{\"description\":\"PostgreSQL database servers. Select version  minimum TLS version Azure Database for MySQL server to enforce\",\"displayName\":\"PostgreSQL database servers. Select version minimum TLS for MySQL server\"}},\"RedisMinTlsVersion\":{\"type\":\"String\",\"allowedValues\":[\"1.2\",\"1.0\",\"1.1\"],\"defaultValue\":\"1.2\",\"metadata\":{\"description\":\"Select version  minimum TLS version for a Azure Cache for Redis to enforce\",\"displayName\":\"Azure Cache for Redis.Select version minimum TLS for Azure Cache for Redis\"}},\"RedisTLSDeployEffect\":{\"type\":\"String\",\"allowedValues\":[\"Append\",\"Disabled\"],\"defaultValue\":\"Append\",\"metadata\":{\"description\":\"Deploy a specific min TLS version requirement and enforce SSL on Azure Cache for Redis. Enables secure server to client by enforce  minimal Tls Version to secure the connection between your database server and your client applications helps protect against 'man in the middle' attacks by encrypting the data stream between the server and your application. This configuration enforces that SSL is always enabled for accessing your database server.\",\"displayName\":\"Azure Cache for Redis. Deploy a specific min TLS version requirement and enforce SSL Azure Cache for Redis\"}},\"RedisTLSEffect\":{\"type\":\"String\",\"allowedValues\":[\"Audit\",\"Deny\",\"Disabled\"],\"defaultValue\":\"Audit\",\"metadata\":{\"description\":\"Azure Cache for Redis. Audit enabling of only connections via SSL to Azure Cache for Redis. Use of secure connections ensures authentication between the server and the service and protects data in transit from network layer attacks such as man-in-the-middle, eavesdropping, and session-hijacking.\",\"displayName\":\"Azure Cache for Redis. Only secure connections to your Azure Cache for Redis should be enabled\"}},\"SQLManagedInstanceMinTlsVersion\":{\"type\":\"String\",\"allowedValues\":[\"1.2\",\"1.0\",\"1.1\"],\"defaultValue\":\"1.2\",\"metadata\":{\"description\":\"Select version  minimum TLS version for Azure Managed Instanceto to  enforce\",\"displayName\":\"Azure Managed Instance.Select version minimum TLS for Azure Managed Instance\"}},\"SQLManagedInstanceTLSDeployEffect\":{\"type\":\"String\",\"allowedValues\":[\"DeployIfNotExists\",\"Disabled\"],\"defaultValue\":\"DeployIfNotExists\",\"metadata\":{\"description\":\"Deploy a specific min TLS version requirement and enforce SSL on SQL servers. Enables secure server to client by enforce  minimal Tls Version to secure the connection between your database server and your client applications helps protect against 'man in the middle' attacks by encrypting the data stream between the server and your application. This configuration enforces that SSL is always enabled for accessing your database server.\",\"displayName\":\"Azure Managed Instance. Deploy a specific min TLS version requirement and enforce SSL on SQL servers\"}},\"SQLManagedInstanceTLSEffect\":{\"type\":\"String\",\"allowedValues\":[\"Audit\",\"Disabled\",\"Deny\"],\"defaultValue\":\"Audit\",\"metadata\":{\"description\":\"Setting minimal TLS version to 1.2 improves security by ensuring your SQL Managed Instance can only be accessed from clients using TLS 1.2. Using versions of TLS less than 1.2 is not recommended since they have well documented security vulnerabilities.\",\"displayName\":\"SQL Managed Instance should have the minimal TLS version of 1.2\"}},\"SQLServerTLSDeployEffect\":{\"type\":\"String\",\"allowedValues\":[\"DeployIfNotExists\",\"Disabled\"],\"defaultValue\":\"DeployIfNotExists\",\"metadata\":{\"description\":\"Deploy a specific min TLS version requirement and enforce SSL on SQL servers. Enables secure server to client by enforce  minimal Tls Version to secure the connection between your database server and your client applications helps protect against 'man in the middle' attacks by encrypting the data stream between the server and your application. This configuration enforces that SSL is always enabled for accessing your database server.\",\"displayName\":\"Azure SQL Database. Deploy a specific min TLS version requirement and enforce SSL on SQL servers\"}},\"SQLServerTLSEffect\":{\"type\":\"String\",\"allowedValues\":[\"Audit\",\"Disabled\",\"Deny\"],\"defaultValue\":\"Audit\",\"metadata\":{\"description\":\"Setting minimal TLS version to 1.2 improves security by ensuring your Azure SQL Database can only be accessed from clients using TLS 1.2. Using versions of TLS less than 1.2 is not recommended since they have well documented security vulnerabilities.\",\"displayName\":\"Azure SQL Database should have the minimal TLS version of 1.2\"}},\"SQLServerminTlsVersion\":{\"type\":\"String\",\"allowedValues\":[\"1.2\",\"1.0\",\"1.1\"],\"defaultValue\":\"1.2\",\"metadata\":{\"description\":\"Select version  minimum TLS version for Azure SQL Database to enforce\",\"displayName\":\"Azure SQL Database.Select version minimum TLS for Azure SQL Database\"}},\"StorageDeployHttpsEnabledEffect\":{\"type\":\"String\",\"allowedValues\":[\"DeployIfNotExists\",\"Disabled\"],\"defaultValue\":\"DeployIfNotExists\",\"metadata\":{\"description\":\"Audit requirement of Secure transfer in your storage account. Secure transfer is an option that forces your storage account to accept requests only from secure connections (HTTPS). Use of HTTPS ensures authentication between the server and the service and protects data in transit from network layer attacks such as man-in-the-middle, eavesdropping, and session-hijacking\",\"displayName\":\"Azure Storage Account. Deploy Secure transfer to storage accounts should be enabled\"}},\"StorageHttpsEnabledEffect\":{\"type\":\"String\",\"allowedValues\":[\"Audit\",\"Deny\",\"Disabled\"],\"defaultValue\":\"Audit\",\"metadata\":{\"description\":\"Audit requirement of Secure transfer in your storage account. Secure transfer is an option that forces your storage account to accept requests only from secure connections (HTTPS). Use of HTTPS ensures authentication between the server and the service and protects data in transit from network layer attacks such as man-in-the-middle, eavesdropping, and session-hijacking\",\"displayName\":\"Azure Storage Account. Secure transfer to storage accounts should be enabled\"}},\"StorageminimumTlsVersion\":{\"type\":\"String\",\"allowedValues\":[\"TLS1_2\",\"TLS1_1\",\"TLS1_0\"],\"defaultValue\":\"TLS1_2\",\"metadata\":{\"description\":\"Select version  minimum TLS version on Azure Storage Account to enforce\",\"displayName\":\"Storage Account select minimum TLS version\"}},\"WebAppServiceHttpsEffect\":{\"type\":\"String\",\"allowedValues\":[\"Audit\",\"Disabled\",\"Deny\"],\"defaultValue\":\"Audit\",\"metadata\":{\"description\":\"Choose Deny or Audit in combination with Append policy. Use of HTTPS ensures server/service authentication and protects data in transit from network layer eavesdropping attacks.\",\"displayName\":\"App Service Web App. Web Application should only be accessible over HTTPS. Choose Deny or Audit in combination with Append policy.\"}},\"WebAppServiceLatestTlsEffect\":{\"type\":\"String\",\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"],\"defaultValue\":\"AuditIfNotExists\",\"metadata\":{\"description\":\"Only Audit, deny not possible as it is a related resource. Upgrade to the latest TLS version.\",\"displayName\":\"App Service Web App. Latest TLS version should be used in your Web App\"}}}"
  policy_type         = "Custom"
  policy_definition_reference {
    parameter_values     = "{\"effect\":{\"value\":\"[parameters('AKSIngressHttpsOnlyEffect')]\"}}"
    policy_definition_id = "/providers/Microsoft.Authorization/policyDefinitions/1a5b4dca-0b6f-4cf5-907c-56316bc1bf3d"
  }
  policy_definition_reference {
    parameter_values     = "{\"effect\":{\"value\":\"[parameters('APIAppServiceHttpsEffect')]\"}}"
    policy_definition_id = "/providers/Microsoft.Management/managementGroups/101/providers/Microsoft.Authorization/policyDefinitions/Deny-AppServiceApiApp-http"
  }
  policy_definition_reference {
    parameter_values     = "{\"effect\":{\"value\":\"[parameters('APIAppServiceLatestTlsEffect')]\"}}"
    policy_definition_id = "/providers/Microsoft.Authorization/policyDefinitions/8cb6aa8b-9e41-4f4e-aa25-089a7ac2581e"
  }
  policy_definition_reference {
    parameter_values     = "{\"effect\":{\"value\":\"[parameters('AppServiceHttpEffect')]\"}}"
    policy_definition_id = "/providers/Microsoft.Management/managementGroups/101/providers/Microsoft.Authorization/policyDefinitions/Append-AppService-httpsonly"
  }
  policy_definition_reference {
    parameter_values     = "{\"effect\":{\"value\":\"[parameters('AppServiceTlsVersionEffect')]\"},\"minTlsVersion\":{\"value\":\"[parameters('AppServiceminTlsVersion')]\"}}"
    policy_definition_id = "/providers/Microsoft.Management/managementGroups/101/providers/Microsoft.Authorization/policyDefinitions/Append-AppService-latestTLS"
  }
  policy_definition_reference {
    parameter_values     = "{\"effect\":{\"value\":\"[parameters('FunctionLatestTlsEffect')]\"}}"
    policy_definition_id = "/providers/Microsoft.Authorization/policyDefinitions/f9d614c5-c173-4d56-95a7-b4437057d193"
  }
  policy_definition_reference {
    parameter_values     = "{\"effect\":{\"value\":\"[parameters('FunctionServiceHttpsEffect')]\"}}"
    policy_definition_id = "/providers/Microsoft.Management/managementGroups/101/providers/Microsoft.Authorization/policyDefinitions/Deny-AppServiceFunctionApp-http"
  }
  policy_definition_reference {
    parameter_values     = "{\"effect\":{\"value\":\"[parameters('MySQLEnableSSLDeployEffect')]\"},\"minimalTlsVersion\":{\"value\":\"[parameters('MySQLminimalTlsVersion')]\"}}"
    policy_definition_id = "/providers/Microsoft.Management/managementGroups/101/providers/Microsoft.Authorization/policyDefinitions/Deploy-MySQL-sslEnforcement"
  }
  policy_definition_reference {
    parameter_values     = "{\"effect\":{\"value\":\"[parameters('MySQLEnableSSLEffect')]\"},\"minimalTlsVersion\":{\"value\":\"[parameters('MySQLminimalTlsVersion')]\"}}"
    policy_definition_id = "/providers/Microsoft.Management/managementGroups/101/providers/Microsoft.Authorization/policyDefinitions/Deny-MySql-http"
  }
  policy_definition_reference {
    parameter_values     = "{\"effect\":{\"value\":\"[parameters('PostgreSQLEnableSSLDeployEffect')]\"},\"minimalTlsVersion\":{\"value\":\"[parameters('PostgreSQLminimalTlsVersion')]\"}}"
    policy_definition_id = "/providers/Microsoft.Management/managementGroups/101/providers/Microsoft.Authorization/policyDefinitions/Deploy-PostgreSQL-sslEnforcement"
  }
  policy_definition_reference {
    parameter_values     = "{\"effect\":{\"value\":\"[parameters('PostgreSQLEnableSSLEffect')]\"},\"minimalTlsVersion\":{\"value\":\"[parameters('PostgreSQLminimalTlsVersion')]\"}}"
    policy_definition_id = "/providers/Microsoft.Management/managementGroups/101/providers/Microsoft.Authorization/policyDefinitions/Deny-PostgreSql-http"
  }
  policy_definition_reference {
    parameter_values     = "{\"effect\":{\"value\":\"[parameters('RedisTLSEffect')]\"},\"minimumTlsVersion\":{\"value\":\"[parameters('RedisMinTlsVersion')]\"}}"
    policy_definition_id = "/providers/Microsoft.Management/managementGroups/101/providers/Microsoft.Authorization/policyDefinitions/Deny-Redis-http"
  }
  policy_definition_reference {
    parameter_values     = "{\"effect\":{\"value\":\"[parameters('RedisTLSDeployEffect')]\"}}"
    policy_definition_id = "/providers/Microsoft.Management/managementGroups/101/providers/Microsoft.Authorization/policyDefinitions/Append-Redis-disableNonSslPort"
  }
  policy_definition_reference {
    parameter_values     = "{\"effect\":{\"value\":\"[parameters('RedisTLSDeployEffect')]\"},\"minimumTlsVersion\":{\"value\":\"[parameters('RedisMinTlsVersion')]\"}}"
    policy_definition_id = "/providers/Microsoft.Management/managementGroups/101/providers/Microsoft.Authorization/policyDefinitions/Append-Redis-sslEnforcement"
  }
  policy_definition_reference {
    parameter_values     = "{\"effect\":{\"value\":\"[parameters('SQLManagedInstanceTLSDeployEffect')]\"},\"minimalTlsVersion\":{\"value\":\"[parameters('SQLManagedInstanceMinTlsVersion')]\"}}"
    policy_definition_id = "/providers/Microsoft.Management/managementGroups/101/providers/Microsoft.Authorization/policyDefinitions/Deploy-SqlMi-minTLS"
  }
  policy_definition_reference {
    parameter_values     = "{\"effect\":{\"value\":\"[parameters('SQLManagedInstanceTLSEffect')]\"},\"minimalTlsVersion\":{\"value\":\"[parameters('SQLManagedInstanceMinTlsVersion')]\"}}"
    policy_definition_id = "/providers/Microsoft.Management/managementGroups/101/providers/Microsoft.Authorization/policyDefinitions/Deny-SqlMi-minTLS"
  }
  policy_definition_reference {
    parameter_values     = "{\"effect\":{\"value\":\"[parameters('SQLServerTLSDeployEffect')]\"},\"minimalTlsVersion\":{\"value\":\"[parameters('SQLServerminTlsVersion')]\"}}"
    policy_definition_id = "/providers/Microsoft.Management/managementGroups/101/providers/Microsoft.Authorization/policyDefinitions/Deploy-SQL-minTLS"
  }
  policy_definition_reference {
    parameter_values     = "{\"effect\":{\"value\":\"[parameters('SQLServerTLSEffect')]\"},\"minimalTlsVersion\":{\"value\":\"[parameters('SQLServerminTlsVersion')]\"}}"
    policy_definition_id = "/providers/Microsoft.Management/managementGroups/101/providers/Microsoft.Authorization/policyDefinitions/Deny-Sql-minTLS"
  }
  policy_definition_reference {
    parameter_values     = "{\"effect\":{\"value\":\"[parameters('StorageDeployHttpsEnabledEffect')]\"},\"minimumTlsVersion\":{\"value\":\"[parameters('StorageMinimumTlsVersion')]\"}}"
    policy_definition_id = "/providers/Microsoft.Management/managementGroups/101/providers/Microsoft.Authorization/policyDefinitions/Deploy-Storage-sslEnforcement"
  }
  policy_definition_reference {
    parameter_values     = "{\"effect\":{\"value\":\"[parameters('StorageHttpsEnabledEffect')]\"},\"minimumTlsVersion\":{\"value\":\"[parameters('StorageMinimumTlsVersion')]\"}}"
    policy_definition_id = "/providers/Microsoft.Management/managementGroups/101/providers/Microsoft.Authorization/policyDefinitions/Deny-Storage-minTLS"
  }
  policy_definition_reference {
    parameter_values     = "{\"effect\":{\"value\":\"[parameters('WebAppServiceHttpsEffect')]\"}}"
    policy_definition_id = "/providers/Microsoft.Management/managementGroups/101/providers/Microsoft.Authorization/policyDefinitions/Deny-AppServiceWebApp-http"
  }
  policy_definition_reference {
    parameter_values     = "{\"effect\":{\"value\":\"[parameters('WebAppServiceLatestTlsEffect')]\"}}"
    policy_definition_id = "/providers/Microsoft.Authorization/policyDefinitions/f0e6e85b-9b9f-4a4b-b67b-f730d42f1b0b"
  }
}
